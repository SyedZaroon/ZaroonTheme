{% comment %}
  Custom product section with schema-enabled title, price, compare-at-price,
  and form controls. Can be reused in product template.
{% endcomment %}

{{ 'main-product.css' | asset_url | stylesheet_tag }}
<script src="{{ 'main-product.js' | asset_url }}" defer></script>

<div class="main-product" data-product-json='{{ product | json | escape }}'>
  <!-- LEFT SIDE IMAGES -->
  <div class="product-images">
    {% render 'product-image-slider', product: product %}
  </div>

  <!-- RIGHT SIDE CONTENT -->
  <div class="product-content">
    <div class="product-info">
      {% assign current_variant = product.selected_or_first_available_variant %}
      {%- assign product_form_id = 'product-form-' | append: section.id -%}

      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'title' %}
            <h1 class="product-title">{{ product.title }}</h1>

          {% when 'price' %}
            <div class="product-prices">
              <p class="product-price">
                {{ product.selected_or_first_available_variant.price | money }}
              </p>

              {% if section.settings.show_compare_price and current_variant.compare_at_price > current_variant.price %}
                <p class="product-compare">
                  <compare-at-price class="compare-price">
                    {% if product.selected_or_first_available_variant.compare_at_price
                        > product.selected_or_first_available_variant.price
                    %}
                      {{ product.selected_or_first_available_variant.compare_at_price | money }}
                    {% endif %}
                  </compare-at-price>
                </p>
              {% endif %}
            </div>
          {% when 'sku' %}
            <p class="product-sku">
              {{ product.selected_or_first_available_variant.sku }}
            </p>

          {% when 'inventory' %}
            {% if current_variant.available %}
              <p class="product-inventory low-stock">
                ⚠️ Only {{ current_variant.inventory_quantity }} left in stock!
              </p>
            {% else %}
              <p class="product-inventory out-of-stock">❌ Out of stock</p>
            {% endif %}

          {% when 'variant-picker' %}
            {% form 'product', product, class: 'product-form' %}
              {% render 'variant-picker', product: product %}

              <input type="number" name="quantity" min="1" value="1">
              <button type="submit" class="product-form__submit">Add to Cart</button>
            {% endform %}

        {% endcase %}
      {% endfor %}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "t:general.product",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_images",
      "label": "Show product images",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "title",
      "name": "Title",
      "settings": []
    },
    {
      "type": "price",
      "name": "Price",
      "settings": []
    },
    {
      "type": "sku",
      "name": "SKU",
      "settings": []
    },
    {
      "type": "inventory",
      "name": "Inventory",
      "settings": []
    },
    {
      "type": "variant-picker",
      "name": "Variant Picker",
      "settings": []
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
